# 测试策略与套件设计

## 目标
- 保证功能正确、性能达标、安全合规、体验一致；实现自动化、可追溯与可度量。

## 测试类型
- 单元测试：算法与工具函数、数据转换、解析器与路由策略。
- 集成测试：MCP↔HA 调用、OAuth 授权链路、WS 订阅与节流。
- 端到端测试：用户输入→意图分类→槽位解析→服务调用→状态反馈→话术播报。
- 专项测试：性能（延迟/吞吐）、安全（权限最小化/脱敏）、兼容（多端一致）。

## 设计方法
- 等价类与边界值、异常路径、幂等与重试、数据驱动（固定数据集）。
- 断言标准：结构字段、正则前缀、时间阈值、关键词集合、状态与属性匹配。

## 覆盖率与门禁
- 核心模块覆盖率≥90%，非核心≥80%；未达标阻断合并。
- 报告：按模块/文件输出趋势与低覆盖清单。

## 数据集与工具
- 话术集：控制/查询/知识/闲聊；词典与实体映射；敏感字段模式表。
- 工具：pytest/coverage、Playwright 或 requests+ws、k6 压测。

## 回归测试
- 触发：发布前、重大合并、夜间构建；套件包含功能 P0、关键路径端到端与风险区域专项。

## 报告产物
- junit.xml、coverage 报告、performance.json；汇总到统一报告目录并与 Story/用例追溯。
